(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{102:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.IndexMapEn="second_minute_hour_day_week_month_year".split("_"),t.IndexMapZH="\u79d2_\u5206\u949f_\u5c0f\u65f6_\u5929_\u5468_\u6708_\u5e74".split("_"),t.ATTR_DATA_TID="data-tid",t.SEC_ARRAY=[60,60,24,7,365/7/12,12],t.ATTR_TIMEAGO="data-timeago",t.ATTR_DATETIME="datetime"},107:function(e,t,n){"use strict";var r=n(105),a=n.n(r),i=n(106),c=n(73),s=n(74),u=n(117),o=n.n(u),l=(n(119),n(120)),m=n.n(l),f=new(function(){function e(){Object(c.a)(this,e),this.displayNumber=20,o.a.apps.length||o.a.initializeApp({databaseURL:"https://hacker-news.firebaseio.com"}),this.api=o.a.database().ref("/v0"),this.cache=m()({max:500,maxAge:36e5})}return Object(s.a)(e,[{key:"getTopStoryItems",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n,r,c,s=this,u=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:1,e.next=3,this.getTopStoryItemIds();case 3:return n=e.sent,r=this.displayNumber*(t-1),c=r+this.displayNumber,e.next=8,Promise.all(n.slice(r,c).map(function(){var e=Object(i.a)(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.findItem(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()));case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getTopStoryItemIds",value:function(){var e=Object(i.a)(a.a.mark(function e(){var t,n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.cache.has("topstories")){e.next=2;break}return e.abrupt("return",this.cache.get("topstories"));case 2:return e.next=4,this.api.child("/topstories").once("value");case 4:return t=e.sent,n=t.val(),this.cache.set("topstories",n),e.abrupt("return",n);case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"findItem",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.cache.has("item/".concat(t))){e.next=2;break}return e.abrupt("return",this.cache.get("item/".concat(t)));case 2:return e.next=4,this.api.child("/item/".concat(t)).once("value");case 4:return n=e.sent,r=n.val(),this.cache.set("item/".concat(t),r),e.abrupt("return",r);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getComments",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r=this;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",[]);case 2:return e.next=4,Promise.all(t.map(function(){var e=Object(i.a)(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.findItem(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()));case 4:return n=e.sent,e.next=7,Promise.all(n.map(function(){var e=Object(i.a)(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.getComments(t.kids);case 2:return t.comments=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()));case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"findUser",value:function(){var e=Object(i.a)(a.a.mark(function e(t){var n,r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.cache.has("/user/".concat(t))){e.next=2;break}return e.abrupt("return",this.cache.get("/user/".concat(t)));case 2:return e.next=4,this.api.child("/user/".concat(t)).once("value");case 4:return n=e.sent,r=n.val(),this.cache.set("/user/".concat(t),r),e.abrupt("return",r);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}());t.a=f},109:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setTidAttr=t.getDateAttr=t.getAttr=t.nextInterval=t.diffSec=t.formatDiff=t.toDate=t.toInt=void 0;var r=n(102),a=n(110),i=t.toInt=function(e){return parseInt(e)},c=t.toDate=function(e){return e instanceof Date?e:!isNaN(e)||/^\d+$/.test(e)?new Date(i(e)):(e=(e||"").trim().replace(/\.\d+/,"").replace(/-/,"/").replace(/-/,"/").replace(/(\d)T(\d)/,"$1 $2").replace(/Z/," UTC").replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2"),new Date(e))},s=(t.formatDiff=function(e,t,n){t=a.Locales[t]?t:a.Locales[n]?n:"en";for(var c=0,s=e<0?1:0,u=e=Math.abs(e);e>=r.SEC_ARRAY[c]&&c<r.SEC_ARRAY.length;c++)e/=r.SEC_ARRAY[c];return(e=i(e))>(0===(c*=2)?9:1)&&(c+=1),a.Locales[t](e,c,u)[s].replace("%s",e)},t.diffSec=function(e,t){return((t=t?c(t):new Date)-c(e))/1e3},t.nextInterval=function(e){for(var t=1,n=0,a=Math.abs(e);e>=r.SEC_ARRAY[n]&&n<r.SEC_ARRAY.length;n++)e/=r.SEC_ARRAY[n],t*=r.SEC_ARRAY[n];return a=(a%=t)?t-a:t,Math.ceil(a)},t.getAttr=function(e,t){return e.getAttribute?e.getAttribute(t):e.attr?e.attr(t):void 0});t.getDateAttr=function(e){return s(e,r.ATTR_TIMEAGO)||s(e,r.ATTR_DATETIME)},t.setTidAttr=function(e,t){return e.setAttribute?e.setAttribute(r.ATTR_DATA_TID,t):e.attr?e.attr(r.ATTR_DATA_TID,t):void 0}},110:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.register=t.Locales=void 0;var r=n(102),a=t.Locales={en:function(e,t){if(0===t)return["just now","right now"];var n=r.IndexMapEn[parseInt(t/2)];return e>1&&(n+="s"),[e+" "+n+" ago","in "+e+" "+n]},zh_CN:function(e,t){if(0===t)return["\u521a\u521a","\u7247\u523b\u540e"];var n=r.IndexMapZH[parseInt(t/2)];return[e+" "+n+"\u524d",e+" "+n+"\u540e"]}};t.register=function(e,t){a[e]=t}},111:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.run=t.cancel=t.Timers=void 0;var r=n(109),a=n(102),i=t.Timers=[],c=function(e){e&&(clearTimeout(e),delete i[e])};t.cancel=function(e){if(e)c((0,r.getAttr)(e,a.ATTR_DATA_TID));else for(var t in i)c(t)},t.run=function(e,t){var n=setTimeout(function(){c(n),e()},t);return i[n]=0,n}},112:function(e,t,n){"use strict";n.d(t,"a",function(){return m});var r=n(73),a=n(74),i=n(76),c=n(75),s=n(77),u=n(34),o=n.n(u),l=n(78),m=function(e){function t(){return Object(r.a)(this,t),Object(i.a)(this,Object(c.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(a.a)(t,[{key:"render",value:function(){return o.a.createElement("header",{className:"navbar navbar-default"},o.a.createElement("nav",{className:"container"},o.a.createElement("div",{className:"d-flex justify-content-between hidden-lg-up"},o.a.createElement(l.Link,{to:l.URL.name("IndexPage"),className:"navbar-brand"},"Flux Utils Example - Hacker News"))))}}]),t}(o.a.Component)},113:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(116),a=n(110),i=n(111),c=function(e,t){return new r.TimeAgo(e,t)};c.register=a.register,c.cancel=i.cancel,t.default=c,e.exports=t.default},115:function(e,t,n){"use strict";n.d(t,"a",function(){return p});var r=n(73),a=n(74),i=n(76),c=n(75),s=n(77),u=n(108),o=n.n(u),l=n(78),m=n(113),f=n.n(m),p=function(e){function t(){return Object(r.a)(this,t),Object(i.a)(this,Object(c.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(a.a)(t,[{key:"getUrl",value:function(){return this.url?this.url:l.URL.name("ItemPage",{itemId:this.id})}},{key:"getTimeAgo",value:function(){return f()().format(new Date(1e3*this.time))}}]),t}(o.a.Record({by:"",descendants:0,id:null,score:0,time:null,title:"",type:"",url:"",kids:null}))},116:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TimeAgo=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(109),i=n(111);t.TimeAgo=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.nowDate=t,this.defaultLocale=n||"en"}return r(e,[{key:"setLocale",value:function(e){this.defaultLocale=e}},{key:"doRender",value:function(e,t,n){var r=this,c=(0,a.diffSec)(t,this.nowDate);e.innerHTML=(0,a.formatDiff)(c,n,this.defaultLocale);var s=(0,i.run)(function(){r.doRender(e,t,n)},Math.min(1e3*(0,a.nextInterval)(c),2147483647));(0,a.setTidAttr)(e,s)}},{key:"render",value:function(e,t){void 0===e.length&&(e=[e]);for(var n=void 0,r=0,c=e.length;r<c;r++)n=e[r],(0,i.cancel)(n),this.doRender(n,(0,a.getDateAttr)(n),t)}},{key:"format",value:function(e,t){return(0,a.formatDiff)((0,a.diffSec)(e,this.nowDate),t,this.defaultLocale)}}]),e}()},98:function(e,t,n){"use strict";n.r(t);var r=n(105),a=n.n(r),i=n(106),c=n(73),s=n(74),u=n(76),o=n(75),l=n(77),m=n(72),f=n.n(m),p=n(34),h=n.n(p),d=n(103),b=n(112),v=n(14),y=n(107),O=n(78),j=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(o.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this.props.comment.comments.filter(function(e){return!!e.by}).map(function(e){return h.a.createElement(t,{key:e.id,comment:e})});return h.a.createElement("li",null,h.a.createElement("dl",null,h.a.createElement("dt",null,h.a.createElement("ul",{className:"list-inline"},h.a.createElement("li",{className:"by"},h.a.createElement(O.Link,{to:O.URL.name("UserPage",{userId:this.props.comment.by})},this.props.comment.by)),h.a.createElement("li",{className:"time"},this.props.comment.getTimeAgo()))),h.a.createElement("dd",null,h.a.createElement("p",{dangerouslySetInnerHTML:{__html:this.props.comment.text}}),h.a.createElement("ul",null,e))))}}]),t}(h.a.Component),g=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(o.a)(t).call(this,e))).state={isLoading:!0},n.commentApiStream=null,n}return Object(l.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.commentApiStream=Object(v.a)(y.a.getComments(this.props.item.kids)).subscribe(function(t){e.props.actions.commentsAction.sync(t),e.setState({isLoading:!1})})}},{key:"componentWillUnmount",value:function(){this.commentApiStream.unsubscribe()}},{key:"render",value:function(){var e=this.getLoadingComponent(),t=this.getCommentComponents();return h.a.createElement("div",{className:"container"},h.a.createElement("div",{className:"news-item"},h.a.createElement("h3",{className:"title"},h.a.createElement("a",{href:this.props.item.getUrl()},this.props.item.title)),h.a.createElement("div",null,h.a.createElement("ul",{className:"list-inline"},h.a.createElement("li",{className:"score"},this.props.item.score," points"),h.a.createElement("li",{className:"by"},"by"," ",h.a.createElement(O.Link,{to:O.URL.name("UserPage",{userId:this.props.item.by}),className:""},this.props.item.by)),h.a.createElement("li",{className:"time"},this.props.item.getTimeAgo())))),h.a.createElement("div",null,h.a.createElement("h4",null,"Comment ",e),h.a.createElement("ul",null,t)))}},{key:"getCommentComponents",value:function(){return this.state.isLoading?h.a.createElement("p",null,"Loading..."):this.props.comments.isEmpty()?h.a.createElement("p",null,"No comments yet."):this.props.comments.filter(function(e){return!!e.by}).map(function(e){return h.a.createElement(j,{key:e.id,comment:e})})}},{key:"getLoadingComponent",value:function(){return this.state.isLoading?h.a.createElement("span",null,h.a.createElement("i",{className:"fa fa-refresh fa-spin fa-fw"})):null}}]),t}(h.a.Component),A=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(o.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return h.a.createElement("div",null,h.a.createElement(b.a,null),h.a.createElement(g,{actions:this.props.actions,comments:this.state.comments,item:this.state.item}))}}],[{key:"getStores",value:function(e){return[e.stores.commentsStore,e.stores.itemStore]}},{key:"calculateState",value:function(e,t){return{comments:t.stores.commentsStore.getState(),item:t.stores.itemStore.getState()}}}]),t}(h.a.Component),E=d.Container.create(A,{withProps:!0}),w=n(79),k=n(121);var T={SYNC:Symbol("comments/sync")},_=function(){function e(t){Object(c.a)(this,e),this.dispatcher=t}return Object(s.a)(e,[{key:"sync",value:function(e){this.dispatcher.dispatch({type:T.SYNC,comments:e})}}]),e}();var I={NEW_INSTANCE:Symbol("item/newInstance")},S=function(){function e(t){Object(c.a)(this,e),this.dispatcher=t}return Object(s.a)(e,[{key:"newInstance",value:function(e){this.dispatcher.dispatch({type:I.NEW_INSTANCE,attributes:e})}}]),e}();var x=n(115),N=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(o.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(s.a)(t,[{key:"getInitialState",value:function(){return null}},{key:"reduce",value:function(e,t){switch(t.type){case I.NEW_INSTANCE:return new x.a(t.attributes);case I.ADD_COMMENTS:return x.a;default:return e}}}]),t}(d.ReduceStore);var R=n(108),C=n.n(R),D=n(113),L=n.n(D),M=function(e){function t(e){Object(c.a)(this,t);var n=C.a.List();return e.comments=n.withMutations(function(n){e.comments.map(function(e){return n.push(new t(e))})}),Object(u.a)(this,Object(o.a)(t).call(this,e))}return Object(l.a)(t,e),Object(s.a)(t,[{key:"getTimeAgo",value:function(){return L()().format(new Date(1e3*this.time))}}]),t}(C.a.Record({by:"",id:0,parent:0,text:"",time:null,type:"",comments:[]})),P=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(o.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(s.a)(t,[{key:"getInitialState",value:function(){return C.a.List()}},{key:"reduce",value:function(e,t){switch(t.type){case T.SYNC:return C.a.List().withMutations(function(e){t.comments.forEach(function(t){return e.push(new M(t))})});default:return e}}}]),t}(d.ReduceStore);n.d(t,"default",function(){return U});var U=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(o.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){if(!this.props.item)return h.a.createElement(w.a,null);var e=new k.Dispatcher,t=new S(e),n=function(e){return new N(e)}(e),r=function(e){return new _(e)}(e),a=function(e){return new P(e)}(e);t.newInstance(this.props.item);var i={stores:{commentsStore:a,itemStore:n},actions:{commentsAction:r}};return h.a.createElement(E,i)}}],[{key:"initialPropsWillGet",value:function(){f.a.start()}},{key:"getInitialProps",value:function(){var e=Object(i.a)(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.a.findItem(t.params.itemId);case 2:return e.t0=e.sent,e.abrupt("return",{item:e.t0});case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"initialPropsDidGet",value:function(){f.a.done()}}]),t}(h.a.Component)}}]);
//# sourceMappingURL=4.2fbd8272.chunk.js.map