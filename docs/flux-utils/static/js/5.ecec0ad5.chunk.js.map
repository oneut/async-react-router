{"version":3,"sources":["api/HackerNewsApi.js","components/common/Header.js","components/user/UserComponent.js","containers/UserContainer.js","actionTypes/UserType.js","actions/user/UserAction.js","models/User.js","stores/UserStore.js","pages/UserPage.js","dispatchers/UserDispatcher.js"],"names":["hackerNewsApi","HackerNewsApi","Object","_Users_Takashi_GitHub_async_react_router_examples_flux_utils_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_2__","this","displayNumber","Firebase","apps","length","initializeApp","databaseURL","api","database","ref","cache","LRU","max","maxAge","page","getTopStoryItemIds","ids","offset","limit","Promise","all","slice","map","_ref","_Users_Takashi_GitHub_async_react_router_examples_flux_utils_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__","_Users_Takashi_GitHub_async_react_router_examples_flux_utils_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default","a","mark","_callee","id","wrap","_context","prev","next","_this","findItem","abrupt","sent","stop","_x","apply","arguments","has","get","child","once","snapshot","value","val","set","concat","_ref2","_callee5","_context5","_this2","_x4","comments","_ref3","_callee6","comment","_context6","getComments","kids","_x5","Header","react__WEBPACK_IMPORTED_MODULE_5___default","createElement","className","async_react_router__WEBPACK_IMPORTED_MODULE_6__","to","URL","name","React","Component","UserComponent","react_default","props","user","created","karma","UserContainer","UserComponent_UserComponent","state","stores","userStore","prevState","getState","userContainer","Container","create","withProps","userType","NEW_INSTANCE","Symbol","UserAction","dispatcher","classCallCheck","attributes","dispatch","type","User","Immutable","Record","UserStore","action","ReduceStore","UserPage","NotFoundPage","userDispatcher","Dispatcher","userAction","newUserStore","newInstance","params","containers_UserContainer","assign","NProgress","start","findUser","userId","done"],"mappings":"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","file":"static/js/5.ecec0ad5.chunk.js","sourcesContent":["import Firebase from \"firebase/app\";\nimport \"firebase/database\";\nimport LRU from \"lru-cache\";\n\nclass HackerNewsApi {\n  constructor() {\n    this.displayNumber = 20;\n\n    if (!Firebase.apps.length) {\n      Firebase.initializeApp({\n        databaseURL: \"https://hacker-news.firebaseio.com\"\n      });\n    }\n    this.api = Firebase.database().ref(\"/v0\");\n    this.cache = LRU({\n      max: 500,\n      maxAge: 1000 * 60 * 60\n    });\n  }\n\n  async getTopStoryItems(page = 1) {\n    const ids = await this.getTopStoryItemIds();\n    const offset = this.displayNumber * (page - 1);\n    const limit = offset + this.displayNumber;\n    return await Promise.all(\n      ids.slice(offset, limit).map(async (id) => await this.findItem(id))\n    );\n  }\n\n  async getTopStoryItemIds() {\n    if (this.cache.has(\"topstories\")) return this.cache.get(\"topstories\");\n    const snapshot = await this.api.child(\"/topstories\").once(\"value\");\n    const value = snapshot.val();\n    this.cache.set(\"topstories\", value);\n    return value;\n  }\n\n  async findItem(id) {\n    if (this.cache.has(`item/${id}`)) return this.cache.get(`item/${id}`);\n    const snapshot = await this.api.child(`/item/${id}`).once(\"value\");\n    const value = snapshot.val();\n    this.cache.set(`item/${id}`, value);\n    return value;\n  }\n\n  async getComments(ids) {\n    if (!ids) {\n      return [];\n    }\n\n    const comments = await Promise.all(\n      ids.map(async (id) => await this.findItem(id))\n    );\n    return await Promise.all(\n      comments.map(async (comment) => {\n        comment.comments = await this.getComments(comment.kids);\n        return comment;\n      })\n    );\n  }\n\n  async findUser(id) {\n    if (this.cache.has(`/user/${id}`)) return this.cache.get(`/user/${id}`);\n    const snapshot = await this.api.child(`/user/${id}`).once(\"value\");\n    const value = snapshot.val();\n    this.cache.set(`/user/${id}`, value);\n    return value;\n  }\n}\n\nconst hackerNewsApi = new HackerNewsApi();\n\nexport default hackerNewsApi;\n","import React from \"react\";\nimport { Link, URL } from \"async-react-router\";\n\nexport default class Header extends React.Component {\n  render() {\n    return (\n      <header className=\"navbar navbar-default\">\n        <nav className=\"container\">\n          <div className=\"d-flex justify-content-between hidden-lg-up\">\n            <Link to={URL.name(\"IndexPage\")} className=\"navbar-brand\">\n              Flux Utils Example - Hacker News\n            </Link>\n          </div>\n        </nav>\n      </header>\n    );\n  }\n}\n","import React from \"react\";\n\nexport default class UserComponent extends React.Component {\n  render() {\n    return (\n      <div className=\"container\">\n        <h3>User: {this.props.user.id}</h3>\n        <p>created: {this.props.user.created}</p>\n        <p>karma: {this.props.user.karma}</p>\n      </div>\n    );\n  }\n}\n","import React from \"react\";\nimport { Container } from \"flux/utils\";\nimport Header from \"../components/common/Header\";\nimport UserComponent from \"../components/user/UserComponent\";\n\nclass UserContainer extends React.Component {\n  static getStores(props) {\n    return [props.stores.userStore];\n  }\n\n  static calculateState(prevState, props) {\n    return {\n      user: props.stores.userStore.getState()\n    };\n  }\n\n  render() {\n    return (\n      <div>\n        <Header />\n        <UserComponent user={this.state.user} />\n      </div>\n    );\n  }\n}\n\nconst userContainer = Container.create(UserContainer, {\n  withProps: true\n});\nexport default userContainer;\n","export const userType = {\n  NEW_INSTANCE: Symbol(\"user/newInstance\")\n};\n","import { userType } from \"../../actionTypes/UserType\";\n\nclass UserAction {\n  constructor(dispatcher) {\n    this.dispatcher = dispatcher;\n  }\n\n  newInstance(attributes) {\n    this.dispatcher.dispatch({\n      type: userType.NEW_INSTANCE,\n      attributes: attributes\n    });\n  }\n}\n\nexport function newUserAction(dispatcher) {\n  return new UserAction(dispatcher);\n}\n","import Immutable from \"immutable\";\n\nconst UserRecord = Immutable.Record({\n  id: \"\",\n  karma: 0,\n  created: null\n});\n\nexport default class User extends UserRecord {}\n","import { ReduceStore } from \"flux/utils\";\nimport { userType } from \"../actionTypes/UserType\";\nimport User from \"../models/User\";\n\nclass UserStore extends ReduceStore {\n  getInitialState() {\n    return null;\n  }\n\n  reduce(state, action) {\n    switch (action.type) {\n      case userType.NEW_INSTANCE:\n        return new User(action.attributes);\n      default:\n        return state;\n    }\n  }\n}\n\nexport function newUserStore(dispatcher) {\n  return new UserStore(dispatcher);\n}\n","import NProgress from \"nprogress\";\nimport React from \"react\";\nimport UserContainer from \"../containers/UserContainer\";\nimport HackerNewsApi from \"../api/HackerNewsApi\";\nimport NotFoundPage from \"./NotFoundPage\";\nimport { newUserDispatcher } from \"../dispatchers/UserDispatcher\";\nimport { newUserAction } from \"../actions/user/UserAction\";\nimport { newUserStore } from \"../stores/UserStore\";\n\nexport default class UserPage extends React.Component {\n  static initialPropsWillGet() {\n    NProgress.start();\n  }\n\n  static async getInitialProps(attributes) {\n    return {\n      user: await HackerNewsApi.findUser(attributes.params.userId)\n    };\n  }\n\n  static initialPropsDidGet() {\n    NProgress.done();\n  }\n\n  render() {\n    if (!this.props.user) return <NotFoundPage />;\n\n    const userDispatcher = newUserDispatcher();\n    const userAction = newUserAction(userDispatcher);\n    const userStore = newUserStore(userDispatcher);\n    userAction.newInstance(this.props.user);\n\n    const params = {\n      stores: {\n        userStore\n      }\n    };\n\n    return <UserContainer {...params} params={this.props.params} />;\n  }\n}\n","import { Dispatcher } from \"flux\";\n\nexport function newUserDispatcher() {\n  return new Dispatcher();\n}\n"],"sourceRoot":""}